
{% for r in requests%}
  <div class="student-card">
    
    <!-- Header -->
      <div class="first_column">
          <div class="card-header">

              <div class="student-details">
                  <h3>{{r.student.first_name|capfirst}} {{ r.student.last_name|capfirst}}</h3>
                  <p>{{r.student.student_id}} â€¢ {{r.student.email_address}}</p>
              </div>
              <div class="badge">
                  <span class="status {{r.status}}">
                    {% if r.status == "Pending"%}
                      <i class="fa-regular fa-clock" style="margin-right: 3px; margin-left: -3px;"></i>
                    {% elif r.status == "Approved"%}
                      <i class="fa-regular fa-check-circle" style="margin-right: 3px; margin-left: -3px;"></i>
                    {% elif r.status == "Rejected"%}
                      <i class="fa-regular fa-times-circle" style="margin-right: 3px; margin-left: -3px;"></i>
                    {% endif %}
                    {{r.status}}</span>
              </div>
          </div>

          <!-- Info Grid -->
          <div class="info-grid1">
              <div>
                  <p class="label">Department</p>
                  <p>{{r.department_name}}</p>
              </div>
              <div>
                  <p class="label">Document Type</p>
                  <p>{{r.document_type}}</p>
              </div>
              <div>
                  <p class="label">Submitted</p>
                  <p>{{r.time_submitted}}</p>
              </div>
              <div>
              </div>
          </div>

            <!-- Notes -->
          <div class="notes">
              <p class="label">Student Notes</p>
              <p class="note-text">
              {{r.additional_notes}}
              </p>
          </div>


          <!-- File Section -->
          <div class="file-section">
              <p class="file-name"><i class="fa-regular fa-file-lines" style="margin-right: -3px;"></i> {{ r.filename}}</p>

              <div class="buttons">
                  
                  {% if r.file_url %}
                    {% with file_path=r.file_url|cut:SUPABASE_URL|cut:"/storage/v1/object/public/" %}
                      <a href="{% url 'download_file' bucket_name=SUPABASE_BUCKET path=file_path %}" class="btn small" style="text-decoration: none; color: inherit;">
                        <i class="fa-solid fa-download" style="margin-right: 5px;"></i> Download
                      </a>
                    {% endwith %}
                      
                  {% endif %}
                  {% with file_path=r.file_url|cut:SUPABASE_URL|cut:"/storage/v1/object/public/student-uploads/" %}
                      {% if file_path %}
                        <a href="{% url 'preview_file' SUPABASE_BUCKET file_path %}" target="_blank" class="btn small" style="text-decoration: none; color: inherit;">
                          <i class="fa-regular fa-eye" style="margin-right: 5px;"></i> Preview
                        </a>
                      {% endif %}
                    {% endwith %}
                  
              </div>
          </div>
          <!-- Comments -->
          {% for c in r.comments.all %}
          <div class="comments">
              <p class="label">Previous Comments</p>
              <div class="comment">
              <div class="comment-header">
                  <span class="comment-author">{{c.faculty.department}} staff</span>
                  <span class="comment-date">{{ c.created_at|date:"Y-m-d H:i" }}</span>
              </div>
                  {{c.content}}
              </div>
          </div>
          {% empty %}
          <p></p>
          {% endfor %}

          <!-- Comment Box -->
          {% if r.department_name|lower == faculty_department %}
            <form action="{% url 'add_comment' r.id %}" method="post" class="comment-box">
              {% csrf_token %}
              <textarea name="content" placeholder="Add a comment or feedback..." required></textarea>
              <button type="submit" class="btn comment">ðŸ’¬ Comment</button>
            </form>
          {% endif %}
      </div>

    {% if r.department_name|lower == faculty_department %}
      {% if r.status == 'Pending' %}
        <form action="{% url 'update_status' r.id %}" class="actions" method="POST">
          {% csrf_token %}
          <button class="btn approve" type="submit" name="status" value="Approved">âœ” Approve</button>
          <button class="btn reject" type="submit" name="status" value="Rejected">âœ– Reject</button>
        </form>
      {% else %}
        <div class="actions"></div>
      {% endif %}
    {% else %}
      <div class="actions">
        <button class="btn disabled-btn" disabled>âœ” Approve</button>
        <button class="btn disabled-btn" disabled>âœ– Reject</button>
      </div>
    {% endif %}

  </div>
{% endfor %}
